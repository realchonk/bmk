image: openbsd/latest
sources:
  - https://github.com/realchonk/bmk
  - ssh://anon@stuerz.xyz:2269/desktop.git
packages:
  - tcc
tasks:
  - install-deps: |
      pkg_info -Q autoconf | grep '^autoconf-2.69' | xargs doas pkg_add
      pkg_info -Q automake | grep '^automake-1.16' | xargs doas pkg_add
  - build-bootstrap: |
      cd bmk
      touch config.mk
      make configure
      ./configure
      make
      doas make install
      make distclean
  - build-tcc: |
      cd bmk
      mk configure
      CC=tcc ./configure
      mk
      doas mk install
      mk distclean
  - build-self: |
      cd bmk
      mk configure
      ./configure
      mk
      doas mk install
  - build-desktop: |
      # build one of my projects that use bmk, to verify that everything works
      cd desktop
      mk -o obj
      mk -o obj DESTDIR=$PWD/_install install install-etc
      find _install
