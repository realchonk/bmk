-include config.mk

## C Compiler
CC ?= cc

## C Compiler Flags
CFLAGS ?= -g -O0
CFLAGS += -ansi -Wall -Wextra -Wno-deprecated-non-prototype -Wno-implicit-int -Wno-return-type # -Wno-missing-parameter-type

## C Preprocessor Flags
CPPFLAGS ?= -D_GNU_SOURCE -D_BSD_SOURCE -D_POSIX_C_SOURCE=700

## Linker Flags
LDFLAGS ?=

## Installation directory
PREFIX ?= /usr/local

## Build mk
all: mk

## Generate a configure script
configure: configure.ac
	autoreconf -i

## Remove build artifacts
clean:
	rm -f mk

## Remove even more stuff
distclean: clean
	rm -rf build-aux autom4te.cache
	rm -f configure config.status config.log config.h.in config.h config.mk *~

## Install mk into ${PREFIX}
install: mk
	mkdir -p ${DESTDIR}${PREFIX}/bin
	cp -f $< ${DESTDIR}${PREFIX}/bin/

mk: mk.c compats.c mk.h
	${CC} -o mk mk.c compats.c ${CFLAGS} ${CPPFLAGS} ${LDFLAGS}
